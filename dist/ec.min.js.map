{"version":3,"file":"ec.min.js","sources":["../src/common/getTime.js","../src/getDomTarget.js","../src/init.js","../src/index.js"],"sourcesContent":["const date = new Date();\r\nconst timeStr = `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()} ${date.getHours()}:${date.getMinutes()}:${date.getSeconds()}`;\r\nexport default timeStr;","export function initGetDomTarget() { //初始化获取触发错误的dom元素\r\n    this.target = null;\r\n    this.triggerStartTime = 0;\r\n    this.triggerEndTime = 0;\r\n    this.targetClass = '';\r\n    this.targetId = '';\r\n    bindEvent.call(this);\r\n}\r\n\r\nfunction bindEvent() {\r\n    window.addEventListener('click', (e) => {\r\n        e = e || window.event;\r\n        this.target = e.target || e.srcElement;\r\n        this.targetId = e.target.id;\r\n        this.targetClass = e.target.className;\r\n        this.triggerEndTime = new Date().getTime();\r\n    }, false)\r\n}\r\n\r\nexport function createTargetStr() { //创建字符串格式的html元素\r\n    let str = `<`;\r\n    str += this.target.tagName.toLowerCase();\r\n    if (this.targetClass) {\r\n        str += ` class=\"${this.targetClass}\"`;\r\n    }\r\n    if (this.targetId) {\r\n        str += ` id=\"${this.targetId}\"`;\r\n    }\r\n    str += `>……`;\r\n    this.target = null; //生成触发dom元素str后，清除ec实例的目标元素属性\r\n    return str;\r\n}","import timeStr from './common/getTime.js';\r\nimport {\r\n\tinitGetDomTarget,\r\n\tcreateTargetStr\r\n} from './getDomTarget.js';\r\n\r\nexport function initEc(Ec) { //初始化这个类\r\n\tEc.prototype.init = function(cb) {\r\n\t\tthis.ecData = {\r\n\t\t\terrorMesg: '', //错误信息\r\n\t\t\terrorTip: '', //针对错误信息，做出的人性化提示\r\n\t\t\terrorFile: '', //错误文件路径名称\r\n\t\t\terrorLine: '', //错误代码行\r\n\t\t\terrorColum: '', //错误代码列\r\n\t\t\tuserAgent: { //用户代理信息\r\n\r\n\t\t\t},\r\n\t\t\terrorTime: '', //发生错误的事件\r\n\t\t\tuserLocation: '', //发生错误所处地点\r\n\t\t\tdomTarget: '' //触发错误的dom元素\r\n\t\t}\r\n\t\tthis.cb = cb;\r\n\t\tbindGlobalErrorEvent.call(this);\r\n\t\tinitGetDomTarget.call(this);\r\n\t}\r\n}\r\n\r\nfunction bindGlobalErrorEvent() { //给window绑定错误事件处理程序\r\n\twindow.addEventListener('error', (e) => { //如果页面触发了错误\r\n\t\te = e || window.event;\r\n\t\t//获取这些错误信息\r\n\t\tthis.ecData.errorMesg = e.message;\r\n\t\tthis.ecData.errorFile = e.filename;\r\n\t\tthis.ecData.errorLine = e.lineno;\r\n\t\tthis.ecData.errorColum = e.colno;\r\n\t\tthis.ecData.errorTime = timeStr;\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (this.target) { //如果ec实例有错误触发目标，那么生成对应的dom字符串，供传给后台保存，以便清晰记录准确定位\r\n\t\t\t\tthis.ecData.domTarget = createTargetStr.call(this);\r\n\t\t\t}\r\n\t\t\t//执行初始化时用户传入的回调函数，在该函数中执行对错误信息的上报操作\r\n\t\t\tthis.cb(this.ecData);\r\n\t\t}, 0)\r\n\t}, false);\r\n}\r\n\r\nexport default {\r\n\tinitEc\r\n}","import {\r\n\tinitEc\r\n} from './init.js';\r\n\r\nfunction Ec(cb) {\r\n\tthis.init(cb);\r\n}\r\ninitEc(Ec);\r\nexport default Ec;"],"names":["date","Date","timeStr","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","initGetDomTarget","target","triggerStartTime","triggerEndTime","targetClass","targetId","bindEvent","call","window","addEventListener","e","event","srcElement","id","className","getTime","createTargetStr","str","tagName","toLowerCase","initEc","Ec","prototype","init","cb","ecData","errorMesg","errorTip","errorFile","errorLine","errorColum","userAgent","errorTime","userLocation","domTarget","bindGlobalErrorEvent","message","filename","lineno","colno","setTimeout"],"mappings":"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"}