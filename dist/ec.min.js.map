{"version":3,"file":"ec.min.js","sources":["../src/common/getTime.js","../src/common/event.js","../src/getDomTarget.js","../src/init.js","../src/index.js"],"sourcesContent":["const date = new Date();\r\nconst timeStr = `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()} ${date.getHours()}:${date.getMinutes()}:${date.getSeconds()}`;\r\nexport default timeStr;","/**为元素添加事件\r\n * @el 要添加事件的元素\r\n * @eventType 要添加事件的类型（click……）\r\n * @handler 事件对应的处理程序\r\n */\r\nexport function addEvent(el, eventType, handler) {\r\n\tif (el.addEventListener) {\r\n\t\tel.addEventListener(eventType, handler, false);\r\n\t} else if (el.attachEvent) {\r\n\t\tel.attachEvent('on' + eventType, handler);\r\n\t} else {\r\n\t\tel['on' + eventType] = handler;\r\n\t}\r\n}\r\n/**为元素移除事件\r\n * @el 要添加事件的元素\r\n * @eventType 要添加事件的类型（click……）\r\n * @handler 事件对应的处理程序\r\n */\r\nexport function removeEvent(el, eventType, handler) {\r\n\tif (el.removeEventListener) {\r\n\t\tel.removeEventListener(eventType, handler, false);\r\n\t} else if (el.attachEvent) {\r\n\t\tel.detachEvent('on' + eventType, handler);\r\n\t} else {\r\n\t\tel['on' + eventType] = null;\r\n\t}\r\n}\r\n/**获取event对象\r\n * @e 传入的event对象\r\n */\r\nexport function getEventObj(e) {\r\n\treturn e ? e : window.event;\r\n}\r\n/**获取触发事件的目标元素\r\n * @e 传入的event对象\r\n */\r\nexport function getTarget(e) {\r\n\te = this.getEventObj(e)\r\n\treturn e.target || e.srcElement;\r\n}\r\n/**阻止默认行为\r\n * @e 传入的event对象\r\n */\r\nexport function preventDefault(e) {\r\n\te = this.getEventObj(e)\r\n\tif (e.preventDefault) {\r\n\t\te.preventDefault();\r\n\t} else {\r\n\t\te.returnValue = false;\r\n\t}\r\n}\r\n/**阻止冒泡\r\n * @e 传入的event对象\r\n */\r\nexport function stopBubble(e) {\r\n\te = this.getEventObj(e)\r\n\tif (e.stopPropagation) {\r\n\t\te.stopPropagation();\r\n\t} else {\r\n\t\te.event.cancelBubble = true;\r\n\t}\r\n}","import {\r\n    addEvent,\r\n    getEventObj\r\n} from './common/event.js';\r\nexport function initGetDomTarget() { //初始化获取触发错误的dom元素\r\n    this.target = null;\r\n    this.triggerStartTime = 0;\r\n    this.triggerEndTime = 0;\r\n    this.targetClass = '';\r\n    this.targetId = '';\r\n    bindEvent.call(this);\r\n}\r\n\r\nfunction bindEvent() {\r\n    addEvent(window, 'click', (e) => {\r\n        e = getEventObj(e);\r\n        this.target = e.target || e.srcElement;\r\n        this.targetId = e.target.id;\r\n        this.targetClass = e.target.className;\r\n        this.triggerEndTime = new Date().getTime();\r\n    })\r\n}\r\n\r\nexport function createTargetStr() { //创建字符串格式的html元素\r\n    let str = `<`;\r\n    str += this.target.tagName.toLowerCase();\r\n    if (this.targetClass) {\r\n        str += ` class=\"${this.targetClass}\"`;\r\n    }\r\n    if (this.targetId) {\r\n        str += ` id=\"${this.targetId}\"`;\r\n    }\r\n    str += `>……`;\r\n    this.target = null; //生成触发dom元素str后，清除ec实例的目标元素属性\r\n    return str;\r\n}","import timeStr from './common/getTime.js';\r\nimport {\r\n\taddEvent,\r\n\tgetEventObj\r\n} from './common/event.js';\r\nimport {\r\n\tinitGetDomTarget,\r\n\tcreateTargetStr\r\n} from './getDomTarget.js';\r\n\r\nexport function initEc(Ec) { //初始化这个类\r\n\tEc.prototype.init = function(cb) {\r\n\t\tthis.ecData = {\r\n\t\t\terrorMesg: '', //错误信息\r\n\t\t\terrorTip: '', //针对错误信息，做出的人性化提示\r\n\t\t\terrorFile: '', //错误文件路径名称\r\n\t\t\terrorLine: '', //错误代码行\r\n\t\t\terrorColum: '', //错误代码列\r\n\t\t\tuserAgent: { //用户代理信息\r\n\r\n\t\t\t},\r\n\t\t\terrorTime: '', //发生错误的事件\r\n\t\t\tuserLocation: '', //发生错误所处地点\r\n\t\t\tdomTarget: '' //触发错误的dom元素\r\n\t\t}\r\n\t\tthis.cb = cb;\r\n\t\tbindGlobalErrorEvent.call(this);\r\n\t\tinitGetDomTarget.call(this);\r\n\t}\r\n}\r\n\r\nfunction bindGlobalErrorEvent() { //给window绑定错误事件处理程序\r\n\taddEvent(window, 'error', (e) => { //如果页面触发了错误\r\n\t\te = getEventObj(e);\r\n\t\t//获取这些错误信息\r\n\t\tthis.ecData.errorMesg = e.message;\r\n\t\tthis.ecData.errorFile = e.filename;\r\n\t\tthis.ecData.errorLine = e.lineno;\r\n\t\tthis.ecData.errorColum = e.colno;\r\n\t\tthis.ecData.errorTime = timeStr;\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (this.target) { //如果ec实例有错误触发目标，那么生成对应的dom字符串，供传给后台保存，以便清晰记录准确定位\r\n\t\t\t\tthis.ecData.domTarget = createTargetStr.call(this);\r\n\t\t\t}\r\n\t\t\t//执行初始化时用户传入的回调函数，在该函数中执行对错误信息的上报操作\r\n\t\t\tthis.cb(this.ecData);\r\n\t\t}, 0)\r\n\t})\r\n}\r\n\r\nexport default {\r\n\tinitEc\r\n}","import {\r\n\tinitEc\r\n} from './init.js';\r\n\r\nfunction Ec(cb) {\r\n\tthis.init(cb);\r\n}\r\ninitEc(Ec);\r\nexport default Ec;"],"names":["date","Date","timeStr","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","addEvent","el","eventType","handler","addEventListener","attachEvent","getEventObj","e","window","event","initGetDomTarget","target","triggerStartTime","triggerEndTime","targetClass","targetId","bindEvent","call","srcElement","id","className","getTime","createTargetStr","str","tagName","toLowerCase","initEc","Ec","prototype","init","cb","ecData","errorMesg","errorTip","errorFile","errorLine","errorColum","userAgent","errorTime","userLocation","domTarget","bindGlobalErrorEvent","message","filename","lineno","colno","setTimeout"],"mappings":"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"}