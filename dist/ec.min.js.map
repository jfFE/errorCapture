{"version":3,"file":"ec.min.js","sources":["../src/common/getTime.js","../src/common/event.js","../src/getDomTarget.js","../src/getLocation.js","../src/init.js","../src/index.js"],"sourcesContent":["const date = new Date();\r\nconst timeStr = `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()} ${date.getHours()}:${date.getMinutes()}:${date.getSeconds()}`;\r\nexport default timeStr;","/**为元素添加事件\r\n * @el 要添加事件的元素\r\n * @eventType 要添加事件的类型（click……）\r\n * @handler 事件对应的处理程序\r\n */\r\nexport function addEvent(el, eventType, handler) {\r\n\tif (el.addEventListener) {\r\n\t\tel.addEventListener(eventType, handler, false);\r\n\t} else if (el.attachEvent) {\r\n\t\tel.attachEvent('on' + eventType, handler);\r\n\t} else {\r\n\t\tel['on' + eventType] = handler;\r\n\t}\r\n}\r\n/**为元素移除事件\r\n * @el 要添加事件的元素\r\n * @eventType 要添加事件的类型（click……）\r\n * @handler 事件对应的处理程序\r\n */\r\nexport function removeEvent(el, eventType, handler) {\r\n\tif (el.removeEventListener) {\r\n\t\tel.removeEventListener(eventType, handler, false);\r\n\t} else if (el.attachEvent) {\r\n\t\tel.detachEvent('on' + eventType, handler);\r\n\t} else {\r\n\t\tel['on' + eventType] = null;\r\n\t}\r\n}\r\n/**获取event对象\r\n * @e 传入的event对象\r\n */\r\nexport function getEventObj(e) {\r\n\treturn e ? e : window.event;\r\n}\r\n/**获取触发事件的目标元素\r\n * @e 传入的event对象\r\n */\r\nexport function getTarget(e) {\r\n\te = this.getEventObj(e)\r\n\treturn e.target || e.srcElement;\r\n}\r\n/**阻止默认行为\r\n * @e 传入的event对象\r\n */\r\nexport function preventDefault(e) {\r\n\te = this.getEventObj(e)\r\n\tif (e.preventDefault) {\r\n\t\te.preventDefault();\r\n\t} else {\r\n\t\te.returnValue = false;\r\n\t}\r\n}\r\n/**阻止冒泡\r\n * @e 传入的event对象\r\n */\r\nexport function stopBubble(e) {\r\n\te = this.getEventObj(e)\r\n\tif (e.stopPropagation) {\r\n\t\te.stopPropagation();\r\n\t} else {\r\n\t\te.event.cancelBubble = true;\r\n\t}\r\n}","import {\r\n    addEvent,\r\n    getEventObj\r\n} from './common/event.js';\r\nexport function initGetDomTarget() { //初始化获取触发错误的dom元素\r\n    this.target = null;\r\n    this.triggerStartTime = 0;\r\n    this.triggerEndTime = 0;\r\n    this.targetClass = '';\r\n    this.targetId = '';\r\n    bindEvent.call(this);\r\n}\r\n\r\nfunction bindEvent() {\r\n    addEvent(window, 'click', (e) => {\r\n        e = getEventObj(e);\r\n        this.target = e.target || e.srcElement;\r\n        this.targetId = e.target.id;\r\n        this.targetClass = e.target.className;\r\n        this.triggerEndTime = new Date().getTime();\r\n    })\r\n}\r\n\r\nexport function createTargetStr() { //创建字符串格式的html元素\r\n    let str = `<`;\r\n    str += this.target.tagName.toLowerCase();\r\n    if (this.targetClass) {\r\n        str += ` class=\"${this.targetClass}\"`;\r\n    }\r\n    if (this.targetId) {\r\n        str += ` id=\"${this.targetId}\"`;\r\n    }\r\n    str += `>……`;\r\n    this.target = null; //生成触发dom元素str后，清除ec实例的目标元素属性\r\n    return str;\r\n}","export function getLocation() { //html5 API获取经纬度\r\n\tif (navigator.geolocation) {\r\n\t\tnavigator.geolocation.getCurrentPosition(position => {\r\n\t\t\tconsole.log(666)\r\n\t\t\tlet obj = {\r\n\t\t\t\tlocation: `${position.coords.latitude},${position.coords.attitude}`,\r\n\t\t\t\tkey: 'c2e7468c5e2d9b072bc08bcedbe3caca'\r\n\t\t\t}\r\n\t\t\ttransformLaAndLoToAddress.call(this, obj);\r\n\t\t}, err => {\r\n\t\t\tconsole.log(888)\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction transformLaAndLoToAddress(data) { //把经纬度转换成地址\r\n\tlet url = 'restapi.amap.com/v3/geocode/geo';\r\n\tajax({\r\n\t\ttype: 'POST',\r\n\t\turl,\r\n\t\tdata,\r\n\t\tsuccess: response => {\r\n\t\t\tthis.ecData.userLocation = response.regeocode.formatted_address;\r\n\t\t}\r\n\t})\r\n}\r\n\r\nfunction ajax(options) {\r\n\toptions = options || {};\r\n\toptions.type = (options.type || \"GET\").toUpperCase();\r\n\toptions.dataType = options.dataType || \"json\";\r\n\tvar params = formatParams(options.data);\r\n\r\n\t//创建 - 非IE6 - 第一步\r\n\tif (window.XMLHttpRequest) {\r\n\t\tvar xhr = new XMLHttpRequest();\r\n\t} else { //IE6及其以下版本浏览器\r\n\t\tvar xhr = new ActiveXObject('Microsoft.XMLHTTP');\r\n\t}\r\n\r\n\t//接收 - 第三步\r\n\txhr.onreadystatechange = function() {\r\n\t\tif (xhr.readyState == 4) {\r\n\t\t\tvar status = xhr.status;\r\n\t\t\tif (status >= 200 && status < 300) {\r\n\t\t\t\toptions.success && options.success(xhr.responseText, xhr.responseXML);\r\n\t\t\t} else {\r\n\t\t\t\toptions.fail && options.fail(status);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t//连接 和 发送 - 第二步\r\n\tif (options.type == \"GET\") {\r\n\t\txhr.open(\"GET\", options.url + \"?\" + params, true);\r\n\t\txhr.send(null);\r\n\t} else if (options.type == \"POST\") {\r\n\t\txhr.open(\"POST\", options.url, true);\r\n\t\t//设置表单提交时的内容类型\r\n\t\txhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n\t\txhr.send(params);\r\n\t}\r\n}\r\n\r\nfunction formatParams(data) {\r\n\tvar arr = [];\r\n\tfor (var name in data) {\r\n\t\tarr.push(encodeURIComponent(name) + \"=\" + encodeURIComponent(data[name]));\r\n\t}\r\n\tarr.push((\"v=\" + Math.random()).replace(\".\"));\r\n\treturn arr.join(\"&\");\r\n}","import timeStr from './common/getTime.js';\r\nimport {\r\n\taddEvent,\r\n\tgetEventObj\r\n} from './common/event.js';\r\nimport {\r\n\tinitGetDomTarget,\r\n\tcreateTargetStr\r\n} from './getDomTarget.js';\r\nimport {\r\n\tgetLocation\r\n} from './getLocation.js';\r\n\r\nexport function initEc(Ec) { //初始化这个类\r\n\tEc.prototype.init = function(cb) {\r\n\t\tthis.ecData = {\r\n\t\t\terrorMesg: '', //错误信息\r\n\t\t\terrorTip: '', //针对错误信息，做出的人性化提示\r\n\t\t\terrorFile: '', //错误文件路径名称\r\n\t\t\terrorLine: '', //错误代码行\r\n\t\t\terrorColum: '', //错误代码列\r\n\t\t\tuserAgent: { //用户代理信息\r\n\r\n\t\t\t},\r\n\t\t\terrorTime: '', //发生错误的事件\r\n\t\t\tuserLocation: '', //发生错误所处地点\r\n\t\t\tdomTarget: '' //触发错误的dom元素\r\n\t\t}\r\n\t\tthis.cb = cb;\r\n\t\tbindGlobalErrorEvent.call(this);\r\n\t\tinitGetDomTarget.call(this);\r\n\t\tgetLocation.call(this);\r\n\t}\r\n}\r\n\r\nfunction bindGlobalErrorEvent() { //给window绑定错误事件处理程序\r\n\taddEvent(window, 'error', (e) => { //如果页面触发了错误\r\n\t\te = getEventObj(e);\r\n\t\t//获取这些错误信息\r\n\t\tthis.ecData.errorMesg = e.message;\r\n\t\tthis.ecData.errorFile = e.filename;\r\n\t\tthis.ecData.errorLine = e.lineno;\r\n\t\tthis.ecData.errorColum = e.colno;\r\n\t\tthis.ecData.errorTime = timeStr;\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (this.target) { //如果ec实例有错误触发目标，那么生成对应的dom字符串，供传给后台保存，以便清晰记录准确定位\r\n\t\t\t\tthis.ecData.domTarget = createTargetStr.call(this);\r\n\t\t\t}\r\n\t\t\t//执行初始化时用户传入的回调函数，在该函数中执行对错误信息的上报操作\r\n\t\t\tthis.cb(this.ecData);\r\n\t\t}, 0)\r\n\t})\r\n}\r\n\r\nexport default {\r\n\tinitEc\r\n}","import {\r\n\tinitEc\r\n} from './init.js';\r\n\r\nfunction Ec(cb) {\r\n\tthis.init(cb);\r\n}\r\ninitEc(Ec);\r\nexport default Ec;"],"names":["date","Date","timeStr","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","addEvent","el","eventType","handler","addEventListener","attachEvent","getEventObj","e","window","event","initGetDomTarget","target","triggerStartTime","triggerEndTime","targetClass","targetId","bindEvent","call","srcElement","id","className","getTime","createTargetStr","str","tagName","toLowerCase","getLocation","navigator","geolocation","getCurrentPosition","console","log","obj","location","position","coords","latitude","attitude","key","transformLaAndLoToAddress","data","url","ajax","type","success","ecData","userLocation","response","regeocode","formatted_address","options","toUpperCase","dataType","params","formatParams","XMLHttpRequest","xhr","ActiveXObject","onreadystatechange","readyState","status","responseText","responseXML","fail","open","send","setRequestHeader","arr","name","push","encodeURIComponent","Math","random","replace","join","initEc","Ec","prototype","init","cb","errorMesg","errorTip","errorFile","errorLine","errorColum","userAgent","errorTime","domTarget","bindGlobalErrorEvent","message","filename","lineno","colno","setTimeout"],"mappings":"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"}