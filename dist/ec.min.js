!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Ec=e()}(this,function(){var t=new Date;t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds();function a(t,e,a){t.addEventListener?t.addEventListener(e,a,!1):t.attachEvent?t.attachEvent("on"+e,a):t["on"+e]=a}function r(t){return t||window.event}function e(){this.target=null,this.triggerStartTime=0,this.triggerEndTime=0,this.targetClass="",this.targetId="",function(){var e=this;a(window,"click",function(t){t=r(t),e.target=t.target||t.srcElement,e.targetId=t.target.id,e.targetClass=t.target.className,e.triggerEndTime=(new Date).getTime()})}.call(this)}function i(){var t="<";return t+=this.target.tagName.toLowerCase(),this.targetClass&&(t+=' class="'+this.targetClass+'"'),this.targetId&&(t+=' id="'+this.targetId+'"'),t+=">……",this.target=null,t}function n(t){this.init(t)}return function(){function n(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var a=document.createEvent("CustomEvent");return a.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),a}"function"==typeof window.CustomEvent&&(n.prototype=window.Event.prototype,window.CustomEvent=n,function(){function e(t){var e=new n(t,{detail:this});window.dispatchEvent(e)}var a=window.XMLHttpRequest;window.XMLHttpRequest=function(){var t=new a;return t.addEventListener("abort",function(){e.call(this,"ajaxAbort")},!1),t.addEventListener("error",function(){e.call(this,"ajaxError")},!1),t.addEventListener("load",function(){e.call(this,"ajaxLoad")},!1),t.addEventListener("loadstart",function(){e.call(this,"ajaxLoadStart")},!1),t.addEventListener("progress",function(){e.call(this,"ajaxProgress")},!1),t.addEventListener("timeout",function(){e.call(this,"ajaxTimeout")},!1),t.addEventListener("loadend",function(){e.call(this,"ajaxLoadEnd")},!1),t.addEventListener("readystatechange",function(){e.call(this,"ajaxReadyStateChange")},!1),t}}())}(),n.prototype.init=function(t){null!=t&&"function"==typeof t&&(this.ecData={errorMesg:"",errorTip:"",errorFile:"",errorLine:"",errorColum:"",userAgent:navigator.userAgent,errorTime:"",userLocation:"",domTarget:""},this.cb=t,function(){var e=this;a(window,"error",function(t){t=r(t),e.ecData.errorMesg=t.message,e.ecData.errorFile=t.filename,e.ecData.errorLine=t.lineno,e.ecData.errorColum=t.colno,e.ecData.errorTime=new Date,setTimeout(function(){e.target&&(e.ecData.domTarget=i.call(e)),e.cb(e.ecData)},0)})}.call(this),function(){var n=this;a(window,"ajaxReadyStateChange",function(t){var e=(t=r(t)).detail,a=!1;4==e.readyState&&(404==e.status&&(n.ecData.errorMesg=e.responseURL+" is 404",n.ecData.errorTip=e.responseURL+"找不到",a=!0),500==e.status&&(n.ecData.errorMesg="服务器发生错误")),a&&(n.ecData.errorFile=location.href,n.ecData.errorTime=new Date,setTimeout(function(){n.target&&(n.ecData.domTarget=i.call(n)),n.cb(n.ecData)},0))})}.call(this),e.call(this))},n});
